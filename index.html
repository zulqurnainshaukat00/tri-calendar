<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>3-in-1 Calendar â€” English Â· Islamic Â· Punjabi</title>
  <meta name="theme-color" content="#0b5fff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Tri Calendar">

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon-180.png" sizes="180x180">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon-167.png" sizes="167x167">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon-152.png" sizes="152x152">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon-120.png" sizes="120x120">

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>3-in-1 Calendar</h1>
    <p>English Â· Islamic (Hijri, tabular) Â· Punjabi (fixed solar months) Â· Farming Guide (Sahiwal)</p>
    <div class="header-actions">
      <button id="installBtn" class="ghost" title="Install app">Install</button>
      <button id="darkToggle" class="ghost" title="Toggle theme" aria-label="Toggle theme">ðŸŒ™</button>
    </div>
  </header>

  <section class="controls">
    <div class="row">
      <label for="datePicker">Base date:</label>
      <input type="date" id="datePicker" />
      <button id="todayBtn" title="Jump to today">Today</button>

      <label class="view-label">View:</label>
      <div class="segmented">
        <button data-view="day" class="active">Day</button>
        <button data-view="week">Week</button>
        <button data-view="month">Month</button>
        <button data-view="year">Year</button>
      </div>
      <button id="addReminderBtn" title="Add reminder for selected day">ï¼‹ Reminder</button>
    </div>

    <details>
      <summary>Settings</summary>
      <div class="settings-grid">
        <div class="setting">
          <label for="hijriOffset">Hijri correction (Â± days):</label>
          <input type="number" id="hijriOffset" min="-2" max="2" step="1" value="0" />
          <small>Use if local moon-sighting differs (Â±2).</small>
        </div>

        <div class="setting">
          <label for="punjabiSystem">Punjabi year style:</label>
          <select id="punjabiSystem">
            <option value="vs" selected>Vikram Samvat</option>
            <option value="ns">Nanakshahi</option>
          </select>
          <small>Months use fixed start dates (Chet â‰ˆ 14 Mar). Lunar Bikrami not supported.</small>
        </div>
      </div>
    </details>
  </section>

  <main id="content"></main>

  <footer>
    <div class="legend">
      <span>English</span><span class="islamic">Islamic</span><span class="punjabi">Punjabi</span><span class="custom">My reminder</span><span class="agri">Farming guide</span>
    </div>
    <p class="muted">Islamic uses tabular Hijri (civil). Punjabi months use fixed solar boundaries. Region-specific dates may differ by Â±1 day.</p>
  </footer>

  <dialog id="reminderDialog">
    <form method="dialog" id="reminderForm">
      <h3>Add / Edit Reminder</h3>
      <p id="reminderDate"></p>
      <label>Title
        <input type="text" id="remTitle" required maxlength="80" />
      </label>
      <label>Notes
        <textarea id="remNotes" rows="3" maxlength="500"></textarea>
      </label>
      <div class="dialog-actions">
        <button value="cancel" class="ghost">Cancel</button>
        <button id="saveReminder" value="default">Save</button>
      </div>
    </form>
  </dialog>

  <script src="app.js"></script>
  <script>
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    installBtn.style.display = 'none';
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'inline-block';
    });
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBtn.style.display = 'none';
    });
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js?v=4', { scope: './' })
          .then(() => navigator.serviceWorker.ready.then(r => r.active && r.active.postMessage({type:'PING'})))
          .catch(console.error);
      });
    }
  </script>
</body>
</html>
